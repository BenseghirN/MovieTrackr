<div class="review-form-modal">
  <form [formGroup]="reviewForm" (ngSubmit)="onSubmit()">
    <!-- Rating Section -->
    <div class="form-section">
      <label class="form-label">
        <span>Note</span>
        @if (rating() > 0) {
          <span class="rating-value">{{ rating() }}/5</span>
        }
      </label>

      <div class="rating-container">
        <p-rating
          formControlName="rating"
          [stars]="5"
          [invalid]="isInvalid('rating')"
        />

        @if (isInvalid('rating')) {
          <span class="field-error">
            <i class="pi pi-exclamation-circle"></i>
            Veuillez donner une note
          </span>
        }
      </div>
    </div>

    <!-- Content Section -->
    <div class="form-section">
      <div class="form-label">
        <span>Votre critique</span>
        <span 
          class="char-count"
          [class.error]="contentLength() < 10 || contentLength() > 2000"
        >
          {{ contentLength() }}/2000 (min. 10)
        </span>
      </div>

      <p-editor
        #reviewEditor
        id="review_content"
        formControlName="content"
        [invalid]="isInvalid('content') || contentLength() < 10 || contentLength() > 2000"
        rows="8"
        [style]="{ width: '100%' }"
        (onTextChange)="onEditorTextChange($event)"
        (onInit)="onEditorInit($event)"
      />

      <!-- Validation Messages -->
      <div class="field-messages">
        @if (isInvalid('content') && reviewForm.get('content')?.hasError('required')) {
          <span class="field-error">
            <i class="pi pi-exclamation-circle"></i>
            Le contenu est obligatoire.
          </span>
        }

        @if (contentLength() > 0 && contentLength() < 10) {
          <span class="field-error">
            <i class="pi pi-exclamation-circle"></i>
            Le contenu doit contenir au moins 10 caractères.
          </span>
        }

        @if (contentLength() > 2000) {
          <span class="field-error">
            <i class="pi pi-exclamation-circle"></i>
            Le contenu ne peut pas dépasser 2000 caractères.
          </span>
        }

        @if (validationErrors()['Content']) {
          @for (error of validationErrors()['Content']; track error) {
            <span class="field-error">
              <i class="pi pi-exclamation-circle"></i>
              {{ error }}
            </span>
          }
        }
      </div>
    </div>

    <!-- Actions -->
    <div class="form-actions">
      <p-button
        label="Annuler"
        [text]="true"
        styleClass="cancel-btn"
        type="button"
        (onClick)="onCancel()"
        [disabled]="loading()"
      />

      <p-button
        [label]="isEditMode() ? 'Modifier' : 'Publier'"
        icon="pi pi-check"
        styleClass="submit-btn"
        type="submit"
        [disabled]="!canSubmit()"
        [loading]="loading()"
      />
    </div>
  </form>
</div>