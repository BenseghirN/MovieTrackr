<div class="movie-reviews">
  <div class="reviews-header">
    <div class="reviews-title">
      <h2>Critiques</h2>
      @if (averageRating()) {
        <div class="average-rating">
          <i class="pi pi-star-fill"></i>
          <span>{{ averageRating() | number:'1.1-1' }}/10</span>
          <span class="reviews-count">({{ totalCount() }} avis)</span>
        </div>
      }
    </div>

    @if (isAuthenticated()) {
      <p-button
        label="Écrire une critique"
        icon="pi pi-pencil"
        (onClick)="onWriteReview()"
        styleClass="write-review-btn"
      />
    }
  </div>

  @if (loading()) {
    <div class="loading-container">
      <p-progressSpinner />
    </div>
  }

  @if (!loading() && hasReviews()) {
    <div class="reviews-list">
      @for (review of reviews(); track review.id) {
        <app-review-card
          [review]="review"
          (edit)="onEdit()"
          (delete)="onDelete()"
        />
      }
    </div>

    @if (totalPages() > 1) {
      <p-paginator
        [rows]="pageSize()"
        [totalRecords]="totalCount()"
        [first]="(currentPage() - 1) * pageSize()"
        [rowsPerPageOptions]="[5, 10, 20]"
        (onPageChange)="onPageChange($event)"
      />
    }
  }

  @if (!loading() && !hasReviews()) {
    <div class="no-reviews">
      <i class="pi pi-star"></i>
      <p>Aucune critique pour le moment</p>
      @if (isAuthenticated()) {
        <p-button
          label="Soyez le premier à donner votre avis !"
          (onClick)="onWriteReview()"
          [outlined]="true"
        />
      } @else {
        <p class="login-prompt">
          <a (click)="login()">Connectez-vous</a>
          pour écrire la première critique
        </p>
      }
    </div>
  }
</div>