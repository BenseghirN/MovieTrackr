<div class="list-details-page">
  @if (loading()) {
    <div class="loading-container">
      <p-progressSpinner />
    </div>
  }

  @if (error()) {
    <div class="error-message">
      <i class="pi pi-exclamation-triangle"></i>
      <p>{{ error() }}</p>
      <div class="error-actions">
        <p-button
          label="Retour"
          icon="pi pi-arrow-left"
          [outlined]="true"
          (onClick)="onBack()"
        />
        <p-button
          label="Réessayer"
          icon="pi pi-refresh"
          (onClick)="onReload()"
        />
      </div>
    </div>
  }

  @if (!loading() && !error() && listDetails(); as list) {
    <div class="page-header">
      <div class="header-left">
        <p-button
          icon="pi pi-arrow-left"
          [text]="true"
          [rounded]="true"
          (onClick)="onBack()"
          pTooltip="Retour aux listes"
        />
        
        <div class="list-info">
          <h1>{{ list.title }}</h1>
          @if (list.description) {
            <p class="description">{{ list.description }}</p>
          }
          <div class="meta">
            <span class="movie-count">
              <i class="pi pi-film"></i>
              {{ list.movies.length }} film{{ list.movies.length > 1 ? 's' : '' }}
            </span>
            <span class="created-date">
              <i class="pi pi-calendar"></i>
              Créée le {{ list.createdAt | date:'dd/MM/yyyy' }}
            </span>
          </div>
        </div>
      </div>
      
      @if (isAuthenticated()) {
        <div class="header-actions">
          <app-reorder-movies-popover 
            [listId]="list.id"
            [movies]="list.movies"
            (reordered)="onReordered()"
          />
          <p-button
            icon="pi pi-pencil"
            label="Modifier"
            [outlined]="true"
            severity="secondary"
            (onClick)="onEditList()"
          />
          @if (!list.isSystemList) {
            <p-button
              icon="pi pi-trash"
              label="Supprimer"
              [outlined]="true"
              severity="danger"
              (onClick)="onDeleteList()"
            />
          }
        </div>
      }
    </div>

    <div class="movies-section">
      @if (hasMovies()) {
        <div class="movies-grid">
          @for (item of list.movies; track item.movieId) {
            <div class="movie-item">
              <div class="movie-position">
                <span>#{{ item.position / 10 }}</span>
              </div>
              
              <app-movie-card
                [movie]="{
                  id: item.movie.id,
                  title: item.movie.title,
                  posterUrl: item.movie.posterUrl,
                  year: item.movie.year
                }"
                (click)="onViewMovie(item.movie.id)"
              />
              
              @if (isAuthenticated()) {
                <div class="movie-actions">
                  <p-button
                    icon="pi pi-times"
                    [rounded]="true"
                    severity="danger"
                    size="small"
                    (onClick)="onRemoveMovie(item.movieId); $event.stopPropagation()"
                    pTooltip="Retirer de la liste"
                  />
                </div>
              }
            </div>
          }
        </div>
      } @else {
        <div class="empty-movies">
          <i class="pi pi-film"></i>
          <h2>Aucun film dans cette liste</h2>
          <p>Commencez à ajouter des films à votre liste depuis les pages de films</p>
        </div>
      }
    </div>
  }
</div>