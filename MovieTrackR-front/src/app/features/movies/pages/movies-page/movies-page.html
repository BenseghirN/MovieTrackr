<div class="movies-page">
  <h1>üîç Recherche de films</h1>

  <div class="search-bar">
    <input
      type="text"
      pInputText
      placeholder="Rechercher un film..."
      [(ngModel)]="searchQuery"
      (keyup)="onSearchKeyup($event)"
      class="search-input"
    />
    <p-button
      label="Rechercher"
      icon="pi pi-search"
      (click)="currentPage.set(1); search()"
      [loading]="loading()"
    ></p-button>
  </div>

  @if (loading()) {
    <div class="loading-container">
      <p-progressSpinner></p-progressSpinner>
    </div>
  }

  @if (error()) {
    <div class="error-message">
      <i class="pi pi-exclamation-triangle"></i>
      {{ error() }}
    </div>
  }

  @if (showNoResults()) {
    <div class="no-results">
      <i class="pi pi-info-circle"></i>
      Aucun film trouv√© pour "{{ searchQuery() }}"
    </div>
  }

  @if (hasResults()) {
    <div class="results-info">
      <span>{{ totalResults() }} r√©sultat(s) trouv√©(s)</span>
    </div>

    <div class="movies-grid">
      @for (movie of movies(); track movie.tmdbId) {
        <p-card class="movie-card">
          <div class="movie-poster">
            <img
              [src]="imageService.getPosterUrl(movie.posterPath, 'w342')"
              [alt]="movie.title"
              loading="lazy"
            />
          </div>
          <div class="movie-info">
            <h3 class="movie-title">{{ movie.title }}</h3>
            @if (movie.year) {
              <span class="movie-year">{{ movie.year }}</span>
            }
            @if (movie.voteAverage) {
              <div class="movie-rating">
                <i class="pi pi-star-fill"></i>
                {{ movie.voteAverage | number:'1.1-1' }}
              </div>
            }
          </div>
        </p-card>
      }
    </div>

    <p-paginator
      [rows]="pageSize()"
      [totalRecords]="totalResults()"
      [first]="(currentPage() - 1) * pageSize()"
      [rowsPerPageOptions]="[10, 20, 50]"
      (onPageChange)="onPageChange($event)"
    ></p-paginator>
  }
</div>