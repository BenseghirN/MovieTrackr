<div class="user-profile-page">
  <div class="user-profile-container">
    <!-- Toolbar haut -->
    <div class="user-profile-toolbar">
      <button
        pButton
        type="button"
        label="Retour"
        icon="pi pi-arrow-left"
        class="p-button-text"
        (click)="onBack()"
      ></button>
    </div>

    <!-- Loading -->
    <div *ngIf="loading(); else loaded" class="user-profile-loading">
      <p-progressSpinner></p-progressSpinner>
    </div>

    <ng-template #loaded>
      <!-- Erreur -->
      <div *ngIf="error(); else profileBlock" class="user-profile-error">
        {{ error() }}
      </div>

      <!-- Profil -->
      <ng-template #profileBlock>
        <ng-container *ngIf="userProfile() as profile">
          <section class="user-profile-card">
            <div class="user-profile-avatar">
              <div class="avatar-circle">
                {{ profile.pseudo.charAt(0) | uppercase }}
              </div>
            </div>

            <div class="user-profile-info">
              <h1 class="user-profile-name">{{ profile.pseudo }}</h1>

              <p class="user-profile-meta">
                Membre depuis
                <ng-container *ngIf="joinedYear(); else fullDate">
                  {{ joinedYear() }}
                </ng-container>
                <ng-template #fullDate>
                  {{ profile.createdAt | date : 'longDate' }}
                </ng-template>
              </p>

              <div class="user-profile-stats">
                <div class="stat">
                  <span class="value">{{ profile.reviewsCount }}</span>
                  <span class="label">critique(s)</span>
                </div>
                <div class="stat">
                  <span class="value">{{ profile.listsCount }}</span>
                  <span class="label">liste(s)</span>
                </div>
              </div>
            </div>
          </section>
          <section class="profile-tabs">
            <p-tabs [value]="activeTab()">
              <p-tablist>
                @for (tab of tabs; track tab.value) {
                  <p-tab
                    [value]="tab.value"
                    (click)="activeTab.set(tab.value)"
                    class="flex items-center gap-2 text-inherit"
                  >
                    <i [class]="tab.icon"></i>
                    <span>{{ tab.label }}</span>
                  </p-tab>
                }
              </p-tablist>
              <p-tabpanels>
                <p-tabpanel value="reviews">
                  @if (userProfile()?.id) {
                    <app-user-profile-reviews-section [userId]="userProfile()?.id" />
                  }
                </p-tabpanel>
                <p-tabpanel value="lists">
                  @if (userProfile()?.id) {
                    <app-user-profile-lists-section [userId]="userProfile()?.id" />
                  }
                </p-tabpanel>
              </p-tabpanels>
            </p-tabs>
          </section>
        </ng-container>
      </ng-template>
    </ng-template>
  </div>
</div>
