<section class="user-reviews-section">
  <div class="section-header">
    <h2>Critiques</h2>

    <div class="section-filters">
      <div class="filter-item">
        <span class="filter-label">Trier par</span>
        <p-select
          [options]="sortOptions"
          optionLabel="label"
          optionValue="value"
          [ngModel]="sort()"
          (onChange)="onSortChange($event.value)"
          [style]="{ width: '100%' }"
        />
      </div>

      <div class="filter-item">
        <span class="filter-label">Filtrer par note</span>
        <p-select
          [options]="ratingOptions"
          optionLabel="label"
          optionValue="value"
          [ngModel]="ratingFilter()"
          (onChange)="onRatingFilterChange($event.value)"
          [style]="{ width: '100%' }"
          placeholder="Toutes les notes"
        />
      </div>
    </div>
  </div>

  @if (loading()) {
    <div class="section-loading">
      <p-progressSpinner />
    </div>
  } @else {
    @if (error()) {
      <p class="error">{{ error() }}</p>
    }

    @if (!error() && reviews().length === 0) {
      <p>Aucune critique pour le moment.</p>
    } @else if (!error() && reviews().length > 0) {
      <div class="reviews-list">
        @for (review of reviews(); track review.id) {
          <app-review-card 
            [review]="review"
            (edit)="onEdit()"
            (delete)="onDelete()"
          />
        }
      </div>

      <p-paginator
        *ngIf="totalCount() > pageSize()"
        [rows]="pageSize()"
        [totalRecords]="totalCount()"
        [first]="(currentPage() - 1) * pageSize()"
        [rowsPerPageOptions]="[5, 10, 20]"
        (onPageChange)="onPageChange($event)"
      />
    }
  }
</section>
